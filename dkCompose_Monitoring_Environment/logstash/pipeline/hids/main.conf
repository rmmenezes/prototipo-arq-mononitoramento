input {
    # REST API port 5044
    tcp {
        port => 5044
    }
}

filter {
     # Drop Elasticsearch Bulk API control lines
    if ([message] =~ '\{"index"') {
        drop {}
    }

	json{
		source => "message"
	 	target => "alert"
	}
    
    # Remove pacotes com headers gerados pela comunicação tcp com o logstash
    if ![alert]{
        drop {}
    }

    mutate {
		remove_field => ["port","type","@version","message","host","path","tags"]
	} 
}

output {
    # Direciona o fluxo de dados para o pipelineMongoDB responsavel pelo armazenamento crú dos arquivos
    pipeline { send_to => hidsMongoDB }
    
    # Direciona o fluxo de dados para o pipelineElasticSearch responsavel pela filtragem/tratamento e indexação
    pipeline { send_to => hidsElasticsearch }
}